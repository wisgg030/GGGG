<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试发布内容显示</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        h1, h2, h3 {
            color: #333;
        }
        .button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 5px;
            cursor: pointer;
            border-radius: 4px;
        }
        .button:hover {
            background-color: #45a049;
        }
        .button.danger {
            background-color: #f44336;
        }
        .button.danger:hover {
            background-color: #da190b;
        }
        .test-result {
            margin-top: 20px;
            padding: 10px;
            background-color: #f9f9f9;
            border-left: 4px solid #4CAF50;
        }
        .error {
            border-left-color: #f44336;
            color: #f44336;
        }
        .success {
            border-left-color: #4CAF50;
            color: #4CAF50;
        }
        ul {
            padding-left: 20px;
        }
        li {
            margin-bottom: 5px;
        }
        a {
            color: #007BFF;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>测试发布内容显示</h1>
        
        <div class="test-section">
            <h2>1. 创建测试数据</h2>
            <button class="button" onclick="createTestData()">创建测试数据</button>
            <button class="button danger" onclick="clearAllData()">清空所有数据</button>
            <div id="testDataResult"></div>
        </div>
        
        <div class="test-section">
            <h2>2. 检查数据存储</h2>
            <button class="button" onclick="checkStorage()">检查localStorage数据</button>
            <div id="storageResult"></div>
        </div>
        
        <div class="test-section">
            <h2>3. 验证页面显示</h2>
            <p>点击下面的链接访问实际页面进行验证：</p>
            <ul>
                <li><a href="home.html" target="_blank">首页 (home.html) - 应显示公开帖子</a></li>
                <li><a href="profile.html" target="_blank">个人页 (profile.html) - 应显示所有发布历史</a></li>
            </ul>
            <h3>模拟验证</h3>
            <button class="button" onclick="simulateHomePage()">模拟首页加载</button>
            <button class="button" onclick="simulateProfilePage()">模拟个人页加载</button>
            <div id="simulationResult"></div>
        </div>
    </div>

    <script>
        // 创建测试数据
        function createTestData() {
            const resultDiv = document.getElementById('testDataResult');
            resultDiv.innerHTML = '';
            
            // 创建测试帖子
            const testPosts = [
                {
                    id: `post_${Date.now()}_1`,
                    userId: '000001',
                    content: '这是一条公开的测试帖子，应该在首页和个人页都显示',
                    isPublic: true,
                    images: [
                        { src: 'assets/images/feed1.jpg' }
                    ],
                    createdAt: new Date().toISOString()
                },
                {
                    id: `post_${Date.now()}_2`,
                    userId: '000001',
                    content: '这是一条非公开的测试帖子，只应该在个人页显示',
                    isPublic: false,
                    images: [
                        { src: 'assets/images/feed2.jpg' }
                    ],
                    createdAt: new Date().toISOString()
                }
            ];
            
            // 获取现有帖子
            let posts = JSON.parse(localStorage.getItem('posts') || '[]');
            let userPosts = JSON.parse(localStorage.getItem('userPosts') || '[]');
            
            // 添加新帖子
            posts.push(...testPosts);
            userPosts.push(...testPosts);
            
            // 保存到localStorage
            localStorage.setItem('posts', JSON.stringify(posts));
            localStorage.setItem('userPosts', JSON.stringify(userPosts));
            
            resultDiv.innerHTML = `
                <div class="test-result success">
                    <h3>测试数据创建成功！</h3>
                    <p>已创建2条测试帖子：</p>
                    <ul>
                        <li>帖子1：公开 - "${testPosts[0].content}"</li>
                        <li>帖子2：非公开 - "${testPosts[1].content}"</li>
                    </ul>
                </div>
            `;
        }
        
        // 清空所有数据
        function clearAllData() {
            const resultDiv = document.getElementById('testDataResult');
            
            localStorage.removeItem('posts');
            localStorage.removeItem('userPosts');
            localStorage.removeItem('homeFeeds');
            
            resultDiv.innerHTML = `
                <div class="test-result success">
                    <h3>所有数据已清空！</h3>
                </div>
            `;
        }
        
        // 检查存储的数据
        function checkStorage() {
            const resultDiv = document.getElementById('storageResult');
            
            const posts = JSON.parse(localStorage.getItem('posts') || '[]');
            const userPosts = JSON.parse(localStorage.getItem('userPosts') || '[]');
            const homeFeeds = JSON.parse(localStorage.getItem('homeFeeds') || '[]');
            
            resultDiv.innerHTML = `
                <div class="test-result">
                    <h3>localStorage数据检查结果：</h3>
                    <p><strong>posts数组：</strong> ${posts.length} 条记录</p>
                    <p><strong>userPosts数组：</strong> ${userPosts.length} 条记录</p>
                    <p><strong>homeFeeds数组：</strong> ${homeFeeds.length} 条记录</p>
                    
                    ${posts.length > 0 ? `
                        <h4>posts数组内容：</h4>
                        <ul>
                            ${posts.map(post => `<li>ID: ${post.id}, 公开: ${post.isPublic}, 内容: ${post.content.substring(0, 20)}...</li>`).join('')}
                        </ul>
                    ` : ''}
                    
                    ${userPosts.length > 0 ? `
                        <h4>userPosts数组内容：</h4>
                        <ul>
                            ${userPosts.map(post => `<li>ID: ${post.id}, 公开: ${post.isPublic}, 内容: ${post.content.substring(0, 20)}...</li>`).join('')}
                        </ul>
                    ` : ''}
                </div>
            `;
        }
        
        // 模拟首页加载
        function simulateHomePage() {
            const resultDiv = document.getElementById('simulationResult');
            
            // 模拟首页的loadHomeFeeds函数
            const posts = JSON.parse(localStorage.getItem('posts') || '[]');
            const publicPosts = posts.filter(post => post.isPublic);
            
            resultDiv.innerHTML = `
                <div class="test-result">
                    <h3>模拟首页加载结果：</h3>
                    <p>从posts数组中筛选出的公开帖子：${publicPosts.length} 条</p>
                    
                    ${publicPosts.length > 0 ? `
                        <h4>公开帖子列表：</h4>
                        <ul>
                            ${publicPosts.map(post => `<li>ID: ${post.id}, 内容: ${post.content.substring(0, 30)}...</li>`).join('')}
                        </ul>
                        <p><strong>结果：</strong> 成功！首页应该能显示这些公开帖子。</p>
                    ` : `
                        <p><strong>结果：</strong> 没有找到公开帖子，请先创建测试数据。</p>
                    `}
                </div>
            `;
        }
        
        // 模拟个人页加载
        function simulateProfilePage() {
            const resultDiv = document.getElementById('simulationResult');
            
            // 模拟个人页的initHistoryTab函数
            const userPosts = JSON.parse(localStorage.getItem('userPosts') || '[]');
            
            resultDiv.innerHTML = `
                <div class="test-result">
                    <h3>模拟个人页加载结果：</h3>
                    <p>从userPosts数组中获取的发布历史：${userPosts.length} 条</p>
                    
                    ${userPosts.length > 0 ? `
                        <h4>发布历史列表：</h4>
                        <ul>
                            ${userPosts.map(post => `<li>ID: ${post.id}, 公开: ${post.isPublic}, 内容: ${post.content.substring(0, 30)}...</li>`).join('')}
                        </ul>
                        <p><strong>结果：</strong> 成功！个人页应该能显示所有这些发布历史。</p>
                    ` : `
                        <p><strong>结果：</strong> 没有找到发布历史，请先创建测试数据。</p>
                    `}
                </div>
            `;
        }
        
        // 页面加载时自动检查存储数据
        window.onload = function() {
            checkStorage();
        };
    </script>
</body>
</html>