<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•å‘å¸ƒåæ¸…ç©ºåŠŸèƒ½</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        .publish-container {
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .publish-input-container {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 20px;
        }
        .publish-input {
            flex: 1;
            min-height: 100px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: vertical;
        }
        .publish-button-text {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .publish-preview {
            border: 1px solid #eee;
            border-radius: 4px;
            padding: 10px;
            min-height: 100px;
        }
        .preview-item {
            position: relative;
            display: inline-block;
            margin: 10px;
        }
        .preview-item img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 4px;
        }
        .debug-info {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .test-result {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>æµ‹è¯•å‘å¸ƒåæ¸…ç©ºåŠŸèƒ½</h1>
    
    <div class="debug-info">
        <h3>è°ƒè¯•ä¿¡æ¯</h3>
        <div id="debugLogs"></div>
    </div>
    
    <div class="publish-container">
        <!-- å‘å¸ƒå†…å®¹åŒºåŸŸ -->
        <div class="publish-input-container">
            <button class="publish-tool-item input-side-button" id="addImage">ğŸ“·</button>
            <textarea class="publish-input" placeholder="æµ‹è¯•å†…å®¹..." id="postContent"></textarea>
            <button class="publish-button-text" id="publishBtn">å‘å¸ƒ</button>
        </div>
        <!-- éšè—çš„æ–‡ä»¶è¾“å…¥å…ƒç´  -->
        <input type="file" id="imageInput" accept="image/*" style="display: none;">
        <!-- å›¾ç‰‡é¢„è§ˆå®¹å™¨ -->
        <div class="publish-preview" id="imagePreview" style="display: none;"></div>
    </div>
    
    <div class="test-result" id="testResult"></div>
    
    <script src="js/page-specific/publish.js"></script>
    
    <script>
        // æ·»åŠ é¢å¤–çš„è°ƒè¯•æ—¥å¿—
        function log(message, type = 'info') {
            const logsDiv = document.getElementById('debugLogs');
            const logEntry = document.createElement('div');
            logEntry.className = `log-${type}`;
            logEntry.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            logsDiv.appendChild(logEntry);
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }
        
        // é‡å†™publishPostå‡½æ•°ä»¥æ·»åŠ æµ‹è¯•éªŒè¯
        const originalPublishPost = window.publishPost;
        window.publishPost = function() {
            log('å‘å¸ƒæŒ‰é’®ç‚¹å‡»ï¼Œå¼€å§‹å‘å¸ƒè¿‡ç¨‹');
            
            // è®°å½•å‘å¸ƒå‰çš„çŠ¶æ€
            const preContent = document.getElementById('postContent').value;
            const prePreview = document.getElementById('imagePreview').innerHTML;
            log(`å‘å¸ƒå‰ - å†…å®¹é•¿åº¦: ${preContent.length}, é¢„è§ˆå›¾å­˜åœ¨: ${prePreview !== ''}`);
            
            // æ‰§è¡ŒåŸå§‹å‘å¸ƒå‡½æ•°
            originalPublishPost();
            
            // æ£€æŸ¥å‘å¸ƒåçš„çŠ¶æ€
            setTimeout(() => {
                const postContent = document.getElementById('postContent').value;
                const postPreview = document.getElementById('imagePreview').innerHTML;
                log(`å‘å¸ƒå - å†…å®¹é•¿åº¦: ${postContent.length}, é¢„è§ˆå›¾å­˜åœ¨: ${postPreview !== ''}`);
                
                // éªŒè¯ç»“æœ
                const testResult = document.getElementById('testResult');
                if (postContent === '' && postPreview === '') {
                    testResult.className = 'test-result success';
                    testResult.innerHTML = 'âœ… æµ‹è¯•é€šè¿‡ï¼å‘å¸ƒåè¾“å…¥æ¡†å’Œé¢„è§ˆå›¾å·²æˆåŠŸæ¸…ç©ºã€‚';
                    log('æµ‹è¯•é€šè¿‡ï¼å‘å¸ƒåè¾“å…¥æ¡†å’Œé¢„è§ˆå›¾å·²æˆåŠŸæ¸…ç©ºã€‚', 'success');
                } else {
                    testResult.className = 'test-result error';
                    testResult.innerHTML = 'âŒ æµ‹è¯•å¤±è´¥ï¼å‘å¸ƒåè¾“å…¥æ¡†æˆ–é¢„è§ˆå›¾æœªè¢«æ¸…ç©ºã€‚';
                    log('æµ‹è¯•å¤±è´¥ï¼å‘å¸ƒåè¾“å…¥æ¡†æˆ–é¢„è§ˆå›¾æœªè¢«æ¸…ç©ºã€‚', 'error');
                }
            }, 500); // ç­‰å¾…æ¸…ç©ºæ“ä½œå®Œæˆ
        };
        
        // æ¨¡æ‹Ÿæ·»åŠ å›¾ç‰‡çš„åŠŸèƒ½
        document.getElementById('addImage').addEventListener('click', function() {
            document.getElementById('imageInput').click();
        });
        
        // æ¨¡æ‹Ÿå›¾ç‰‡é¢„è§ˆï¼ˆç®€åŒ–ç‰ˆï¼‰
        document.getElementById('imageInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const preview = document.getElementById('imagePreview');
                    preview.innerHTML = `<div class="preview-item"><img src="${event.target.result}" alt="é¢„è§ˆå›¾"></div>`;
                    preview.style.display = 'block';
                    log('å·²æ·»åŠ å›¾ç‰‡é¢„è§ˆ', 'success');
                };
                reader.readAsDataURL(file);
            }
        });
        
        log('æµ‹è¯•é¡µé¢åˆå§‹åŒ–å®Œæˆ');
    </script>
</body>
</html>