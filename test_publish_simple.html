<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•å‘å¸ƒåŠŸèƒ½è„šæœ¬</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
            white-space: pre-wrap;
        }
        .success {
            color: green;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <h1>æµ‹è¯•å‘å¸ƒåŠŸèƒ½</h1>
    <div id="testResults"></div>
    
    <script>
        // ç®€å•çš„æµ‹è¯•è„šæœ¬ï¼Œç”¨äºéªŒè¯å‘å¸ƒåŠŸèƒ½
        function log(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const p = document.createElement('p');
            p.className = type;
            p.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            resultsDiv.appendChild(p);
        }
        
        log('å¼€å§‹æµ‹è¯•å‘å¸ƒåŠŸèƒ½...');
        
        // 1. æ¸…ç©ºæœ¬åœ°å­˜å‚¨
        localStorage.removeItem('posts');
        localStorage.removeItem('userPosts');
        localStorage.removeItem('homeFeeds');
        log('âœ… å·²æ¸…ç©ºæœ¬åœ°å­˜å‚¨', 'success');
        
        // 2. æ¨¡æ‹Ÿå‘å¸ƒå¸–å­
        function simulatePublishPost() {
            const post = {
                id: Date.now(),
                content: 'è¿™æ˜¯ä¸€æ¡æµ‹è¯•å‘å¸ƒçš„å†…å®¹',
                visibility: 'forever',
                createdAt: new Date().toISOString(),
                isPublic: true,
                images: [],
                userId: '000001'
            };
            
            // ä¿å­˜åˆ°posts
            const posts = JSON.parse(localStorage.getItem('posts')) || [];
            posts.push(post);
            localStorage.setItem('posts', JSON.stringify(posts));
            
            // ä¿å­˜åˆ°userPosts
            const userPosts = JSON.parse(localStorage.getItem('userPosts')) || [];
            userPosts.push(post);
            localStorage.setItem('userPosts', JSON.stringify(userPosts));
            
            log('âœ… å·²å‘å¸ƒæµ‹è¯•å¸–å­', 'success');
            log('   - å¸–å­å†…å®¹:', 'info');
            log('   ' + JSON.stringify(post, null, 2), 'info');
            return post;
        }
        
        // 3. æ¨¡æ‹Ÿé¦–é¡µåŠ è½½
        function simulateHomePageLoad() {
            const posts = JSON.parse(localStorage.getItem('posts')) || [];
            const homePosts = posts.filter(post => post.isPublic);
            
            log('ğŸ“± é¦–é¡µåŠ è½½ç»“æœ:', 'info');
            log('   - æ‰€æœ‰å¸–å­æ•°:', posts.length, 'info');
            log('   - å…¬å¼€å¸–å­æ•°:', homePosts.length, 'info');
            log('   - æ˜¾ç¤ºçš„å¸–å­:', 'info');
            homePosts.forEach(post => {
                log('   ' + JSON.stringify(post, null, 2), 'info');
            });
            
            return homePosts;
        }
        
        // 4. æ¨¡æ‹Ÿä¸ªäººé¡µåŠ è½½
        function simulateProfilePageLoad() {
            const userPosts = JSON.parse(localStorage.getItem('userPosts')) || [];
            
            log('ğŸ‘¤ ä¸ªäººé¡µåŠ è½½ç»“æœ:', 'info');
            log('   - ç”¨æˆ·å‘å¸ƒå¸–å­æ•°:', userPosts.length, 'info');
            log('   - æ˜¾ç¤ºçš„å¸–å­:', 'info');
            userPosts.forEach(post => {
                log('   ' + JSON.stringify(post, null, 2), 'info');
            });
            
            return userPosts;
        }
        
        // 5. æµ‹è¯•é€»è¾‘
        log('\n=== æµ‹è¯•å‘å¸ƒåŠŸèƒ½ ===', 'info');
        simulatePublishPost();
        
        log('\n=== æµ‹è¯•é¦–é¡µæ˜¾ç¤º ===', 'info');
        const homePosts = simulateHomePageLoad();
        
        log('\n=== æµ‹è¯•ä¸ªäººé¡µæ˜¾ç¤º ===', 'info');
        const profilePosts = simulateProfilePageLoad();
        
        // 6. éªŒè¯ç»“æœ
        log('\n=== éªŒè¯ç»“æœ ===', 'info');
        if (homePosts.length === 1 && profilePosts.length === 1) {
            log('âœ… æµ‹è¯•é€šè¿‡ï¼å‘å¸ƒçš„å†…å®¹æˆåŠŸæ˜¾ç¤ºåœ¨é¦–é¡µå’Œæˆ‘çš„é¡µ', 'success');
            log('   - é¦–é¡µæ˜¾ç¤ºäº†1æ¡å…¬å¼€å¸–å­', 'success');
            log('   - ä¸ªäººé¡µæ˜¾ç¤ºäº†1æ¡å‘å¸ƒå†å²', 'success');
        } else {
            log('âŒ æµ‹è¯•å¤±è´¥ï¼', 'error');
            log('   - é¦–é¡µæ˜¾ç¤ºå¸–å­æ•°:', homePosts.length, 'error');
            log('   - ä¸ªäººé¡µæ˜¾ç¤ºå¸–å­æ•°:', profilePosts.length, 'error');
        }
        
        // 7. æ˜¾ç¤ºæœ€ç»ˆçš„æœ¬åœ°å­˜å‚¨æ•°æ®
        log('\n=== æœ¬åœ°å­˜å‚¨æœ€ç»ˆæ•°æ® ===', 'info');
        log('posts:', JSON.parse(localStorage.getItem('posts')), 'info');
        log('userPosts:', JSON.parse(localStorage.getItem('userPosts')), 'info');
        log('homeFeeds:', JSON.parse(localStorage.getItem('homeFeeds')), 'info');
    </script>
</body>
</html>